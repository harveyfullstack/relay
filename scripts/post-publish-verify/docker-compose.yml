# Post-publish verification - Multi-Node.js version testing
#
# Tests agent-relay npm package installation across Node.js 18, 20, and 22
#
# Usage:
#   # Test latest published version across all Node versions
#   docker compose -f scripts/post-publish-verify/docker-compose.yml up --build
#
#   # Test specific version
#   PACKAGE_VERSION=2.0.25 docker compose -f scripts/post-publish-verify/docker-compose.yml up --build
#
#   # Test single Node version
#   docker compose -f scripts/post-publish-verify/docker-compose.yml up --build node20
#
#   # Cleanup
#   docker compose -f scripts/post-publish-verify/docker-compose.yml down --rmi local

services:
  # Node.js 18 (minimum supported version)
  node18:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        NODE_VERSION: "18"
        PACKAGE_VERSION: "${PACKAGE_VERSION:-latest}"
    environment:
      NODE_VERSION: "18"
      PACKAGE_VERSION: "${PACKAGE_VERSION:-latest}"

  # Node.js 20 (LTS)
  node20:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        NODE_VERSION: "20"
        PACKAGE_VERSION: "${PACKAGE_VERSION:-latest}"
    environment:
      NODE_VERSION: "20"
      PACKAGE_VERSION: "${PACKAGE_VERSION:-latest}"

  # Node.js 22 (Current)
  node22:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        NODE_VERSION: "22"
        PACKAGE_VERSION: "${PACKAGE_VERSION:-latest}"
    environment:
      NODE_VERSION: "22"
      PACKAGE_VERSION: "${PACKAGE_VERSION:-latest}"

networks:
  default:
    name: agent-relay-publish-verify
