{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://agentrelay.dev/schemas/inject-response.schema.json",
  "title": "Inject Response",
  "description": "JSON response from the relay-pty Unix socket",
  "oneOf": [
    {
      "type": "object",
      "description": "Response to an inject request",
      "properties": {
        "type": {
          "type": "string",
          "const": "inject_result",
          "description": "Response type for injection results"
        },
        "id": {
          "type": "string",
          "description": "Message ID from the original inject request"
        },
        "status": {
          "type": "string",
          "enum": ["queued", "injecting", "delivered", "failed"],
          "description": "Current status of the message injection"
        },
        "timestamp": {
          "type": "integer",
          "description": "Unix timestamp in milliseconds when this status was recorded"
        },
        "error": {
          "type": "string",
          "description": "Error message if status is 'failed'"
        }
      },
      "required": ["type", "id", "status", "timestamp"],
      "additionalProperties": false
    },
    {
      "type": "object",
      "description": "Response to a status query",
      "properties": {
        "type": {
          "type": "string",
          "const": "status",
          "description": "Response type for status queries"
        },
        "agent_idle": {
          "type": "boolean",
          "description": "Whether the agent is currently idle (not actively outputting)"
        },
        "queue_length": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of messages waiting in the injection queue"
        },
        "cursor_position": {
          "type": "array",
          "items": { "type": "integer" },
          "minItems": 2,
          "maxItems": 2,
          "description": "Cursor position [x, y] in the terminal (optional)"
        },
        "last_output_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "Milliseconds since the agent last produced output"
        }
      },
      "required": ["type", "agent_idle", "queue_length", "last_output_ms"],
      "additionalProperties": false
    },
    {
      "type": "object",
      "description": "Backpressure notification when queue is full",
      "properties": {
        "type": {
          "type": "string",
          "const": "backpressure",
          "description": "Response type for backpressure notification"
        },
        "queue_length": {
          "type": "integer",
          "minimum": 0,
          "description": "Current number of messages in the queue"
        },
        "accept": {
          "type": "boolean",
          "description": "Whether new messages are being accepted"
        }
      },
      "required": ["type", "queue_length", "accept"],
      "additionalProperties": false
    },
    {
      "type": "object",
      "description": "Acknowledgment of shutdown request",
      "properties": {
        "type": {
          "type": "string",
          "const": "shutdown_ack",
          "description": "Response type for shutdown acknowledgment"
        }
      },
      "required": ["type"],
      "additionalProperties": false
    },
    {
      "type": "object",
      "description": "Error response",
      "properties": {
        "type": {
          "type": "string",
          "const": "error",
          "description": "Response type for errors"
        },
        "message": {
          "type": "string",
          "description": "Error message describing what went wrong"
        }
      },
      "required": ["type", "message"],
      "additionalProperties": false
    }
  ],
  "examples": [
    {
      "_comment": "Message queued for injection",
      "type": "inject_result",
      "id": "msg-abc123",
      "status": "queued",
      "timestamp": 1705420800000
    },
    {
      "_comment": "Message being injected",
      "type": "inject_result",
      "id": "msg-abc123",
      "status": "injecting",
      "timestamp": 1705420801500
    },
    {
      "_comment": "Message successfully delivered",
      "type": "inject_result",
      "id": "msg-abc123",
      "status": "delivered",
      "timestamp": 1705420802000
    },
    {
      "_comment": "Message injection failed",
      "type": "inject_result",
      "id": "msg-abc123",
      "status": "failed",
      "timestamp": 1705420802000,
      "error": "Agent process terminated"
    },
    {
      "_comment": "Status query response - agent idle",
      "type": "status",
      "agent_idle": true,
      "queue_length": 0,
      "cursor_position": [0, 24],
      "last_output_ms": 5000
    },
    {
      "_comment": "Status query response - agent busy",
      "type": "status",
      "agent_idle": false,
      "queue_length": 3,
      "last_output_ms": 150
    },
    {
      "_comment": "Backpressure - queue full",
      "type": "backpressure",
      "queue_length": 50,
      "accept": false
    },
    {
      "_comment": "Backpressure - accepting again",
      "type": "backpressure",
      "queue_length": 25,
      "accept": true
    },
    {
      "_comment": "Shutdown acknowledgment",
      "type": "shutdown_ack"
    },
    {
      "_comment": "Error response",
      "type": "error",
      "message": "Invalid request format"
    }
  ]
}
