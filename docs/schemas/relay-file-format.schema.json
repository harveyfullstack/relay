{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://agentrelay.dev/schemas/relay-file-format.schema.json",
  "title": "Relay File Format",
  "description": "Header-based file format that agents write to /tmp/relay-outbox/$AGENT_RELAY_NAME/<filename>",
  "type": "object",
  "properties": {
    "TO": {
      "type": "string",
      "description": "Target agent name, '*' for broadcast, or '#channel' for channel message",
      "examples": ["Bob", "*", "#general"]
    },
    "KIND": {
      "type": "string",
      "enum": ["message", "spawn", "release"],
      "default": "message",
      "description": "Message type. Defaults to 'message' if TO is set"
    },
    "NAME": {
      "type": "string",
      "description": "Agent name (required for spawn/release)",
      "examples": ["WorkerAgent", "ReviewerBot"]
    },
    "CLI": {
      "type": "string",
      "description": "CLI to use for spawning (required for spawn)",
      "examples": ["claude", "codex", "gemini"]
    },
    "THREAD": {
      "type": "string",
      "description": "Thread identifier for grouping related messages",
      "examples": ["feature-123", "code-review-42"]
    },
    "body": {
      "type": "string",
      "description": "Message content or task description (everything after the blank line)"
    }
  },
  "allOf": [
    {
      "if": {
        "properties": { "KIND": { "const": "message" } }
      },
      "then": {
        "required": ["TO"]
      }
    },
    {
      "if": {
        "properties": { "KIND": { "const": "spawn" } }
      },
      "then": {
        "required": ["NAME", "CLI"]
      }
    },
    {
      "if": {
        "properties": { "KIND": { "const": "release" } }
      },
      "then": {
        "required": ["NAME"]
      }
    }
  ],
  "examples": [
    {
      "_comment": "Simple message",
      "TO": "Bob",
      "body": "Hello Bob, can you review PR #42?"
    },
    {
      "_comment": "Message with thread",
      "TO": "Bob",
      "THREAD": "feature-123",
      "body": "Hello Bob, can you review PR #42?"
    },
    {
      "_comment": "Broadcast",
      "TO": "*",
      "body": "Attention everyone: deployment starting in 5 minutes"
    },
    {
      "_comment": "Channel message",
      "TO": "#general",
      "body": "Has anyone seen the new API docs?"
    },
    {
      "_comment": "Spawn agent",
      "KIND": "spawn",
      "NAME": "ReviewerAgent",
      "CLI": "claude",
      "body": "You are a code reviewer.\nReview the changes in src/auth/*.ts"
    },
    {
      "_comment": "Release agent",
      "KIND": "release",
      "NAME": "ReviewerAgent"
    }
  ]
}
